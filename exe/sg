#!/usr/bin/env ruby
# coding: utf-8
# This file has been generated by easy_app_helper Gem on the Sun Dec 11 12:11:18 2016
# See 'https://rubygems.org/gems/easy_app_helper'

require 'rubygems'
require 'bundler/setup'

require 'easy_app_helper'
require 'easy_app_helper/scripts'
require 'signature_generator'

module SignatureGenerator
  class SgMasterScript < EasyAppHelper::Scripts::Master

    # If you want to manage sub-commands a-la-git, include following
    # include EasyAppHelper::Scripts::SubCommandManager

    # Inserted here, but you may probably have already defined this somewhere else...
    NAME = 'Sg'
    DESCRIPTION = 'Description of sg'

    attr_reader :template_io, :output_io

    def initialize
      super(NAME, SignatureGenerator::VERSION, DESCRIPTION, 'sg')
    end

    def add_script_options
      ## Create here your extra command-line options
      ## Here under are examples using potentially gem config layer to display default option value...
      ## Check Slop documentation for further info.
      config.add_command_line_section do |slop|
        slop.on :f, :'template-file', 'Specify the signature template file. Default is STDIN.', argument: true, as: String
        slop.on :o, :'output-file', 'Specify the output file for the signature. Default is STDOUT.', argument: true, as: String
        slop.on :force, 'Force overwriting output file.', argument: false
      end
    end

    def do_process
      # Your code here.
      content = template_io.read
      logger.debug content
      output_io.puts content
    ensure
      template_io.close
      output_io.close
    end

    def check_config
      # Check the config and raise an exception if incorrect.
      @template_io = case config[:'template-file']
                       when NilClass
                         logger.debug 'Template from STDIN'
                         STDIN
                       when String
                         file = File.expand_path(config[:'template-file'])
                         raise 'Invalid template file specified !' unless File.readable? file
                         io = File.open file, 'r'
                         logger.debug "Template from file '#{file}'"
                         io
                     end
      @output_io = case config[:'output-file']
                     when NilClass
                       logger.debug 'Signature to STDOUT'
                       STDOUT
                     when String
                       file = File.expand_path(config[:'output-file'])
                       if File.exists? file
                         raise 'Output file already exists ! Use --force' unless config[:force]
                       end
                       io = File.open file, 'w'
                       logger.debug "Signature generated into file '#{file}'"
                       io
                   end
    end

  end
end

SignatureGenerator::SgMasterScript.new.run
